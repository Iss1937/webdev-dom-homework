<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments">
      </ul>

      <div class="add-form">
        <input
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
          />
        <textarea
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий , количество символов не менее 10"
          rows="4"></textarea>
        <div class="add-form-row">
          <button class="add-form-button" disabled>Написать</button>
        </div>
      </div>
    </div>
  </body>

  <script>
      
    const container = document.querySelector('.container');
    const commentList = document.querySelector('.comments');
    const addForm = document.querySelector('.add-form');
    const userName = document.querySelector('.add-form-name');
    const textCommment = document.querySelector('.add-form-text');
    const button = document.querySelector('.add-form-button');
    const comments = document.querySelectorAll('.comment');
    const commentsListArray = [
        {
            name: "Глеб Фокин",
            date: "12.02.22 12:18",
            msg: "Это будет первый комментарий на этой странице",
            like: "3",
            Iliked: false,
        },
        {
            name: "Варвара Н.",
            date: "13.02.22 19:22",
            msg: "Мне нравится как оформлена эта страница! ❤",
            like: "75",
            Iliked: false,
        }
    ];

    const addLikes = (e) => {
        commentsListArray[e.target.dataset.id].like = Number(commentsListArray[e.target.dataset.id].like) + 1;
        commentsListArray[e.target.dataset.id].Iliked = true;
    }
    const delLikes = (e) => {
        commentsListArray[e.target.dataset.id].like = Number(commentsListArray[e.target.dataset.id].like) - 1;
        commentsListArray[e.target.dataset.id].Iliked = false;
    }

    const initLikeClick = () => {
        const likeClickElements = document.querySelectorAll('.likes');
        for (const likeClickElement of likeClickElements) {
            likeClickElement.addEventListener('click', (e) => {
                (commentsListArray[e.target.dataset.id].Iliked) ? delLikes(e) : addLikes(e);
                renderComments();
            });
        }
    }

    function renderComments() {
        const commentHtmlResult = commentsListArray.map((comment, id) => {
            (comment.Iliked) ? Iliked = '-active-like' : Iliked = '';
            return `<li class="comment" data-id="${id}">
              <div class="comment-header">
                <div>${comment.name}</div>      
                <div>${comment.date}</div>   
              </div>
              <div class="comment-body">
                <div class="comment-text" data-id="${id}">
                  ${comment.msg}
                </div>
              </div>
              <div class="comment-footer">

                <div class="likes">
                  <span class="likes-counter" >${comment.like}</span>
                  <button class="like-button ${Iliked}" data-id="${id}"></button>
                </div>
              </div>
            </li>`;
        }).join("");
        commentList.innerHTML = commentHtmlResult;
        initLikeClick();
    }


    function valiate() { 
        if (userName.value.length === 0) { 
            userName.classList.add('error'); 
            return false;  
        } else { userName.classList.remove('error'); } 
        if (textCommment.value.length < 10) { 
            textCommment.classList.add('error');  
            return false; 
        } else { textCommment.classList.remove('error'); } 

        if (userName.value.length > 0 && textCommment.value.length >= 10) {  
            return true; 
        }
        else {

            return false; 
        }
    }

    function addComment() { 
        const validate = valiate(); 
        const date = new Date(); 
        if (validate) {  
            commentsListArray.push({
                name: userName.value,
                date: dateFormat(),
                msg: textCommment.value,
                like: 0,
            });

            renderComments();
            textCommment.value = ""; 
            button.setAttribute('disabled', '');
        }
    }

    button.addEventListener('click', (event) => { 
        addComment();
    });

    addForm.addEventListener('input', (event) => {  
        const validate = valiate();
        (validate) ? button.removeAttribute('disabled') : button.setAttribute('disabled', '');
    });

    addForm.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.keyCode == 13) { addComment(); } 
    });


    function dateFormat() {
        const date = new Date();
        (date.getDate() < 10) ? dd = '0' + date.getDate() : dd = date.getDate();
        (date.getMonth() < 10) ? MM = '0' + (date.getMonth() + 1) : MM = (date.getMonth() + 1);
        (date.getFullYear()) ? YY = date.getFullYear().toString().slice(-2) : YY = date.getFullYear().toString().slice(-2);
        (date.getHours() < 10) ? hh = '0' + date.getHours() : hh = date.getHours();
        (date.getMinutes() < 10) ? mm = '0' + date.getMinutes() : mm = date.getMinutes();
        return `${dd}.${MM}.${YY} ${hh}:${mm}`;
    }

    renderComments();
  </script>
</html>